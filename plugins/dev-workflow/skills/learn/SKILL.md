---
name: learn
description: Analyze conversation for learnings - mistakes, solutions, patterns, decisions. Saves as individual files in docs/learnings/ with auto-generated index. Use at end of implementation sessions to build project memory.
argument-hint: [optional topic to focus on]
user-invocable: true
disable-model-invocation: false
model: claude-opus-4-5-20251101
allowed-tools: Read, Write, Edit, Glob, Grep, AskUserQuestion
---

# Learn from Conversation

Analyze this conversation for insights worth preserving.

**If `$ARGUMENTS` provided** → focus on that specific topic
**If no arguments** → analyze full conversation

---

## Phase 1: Deep Analysis

Think deeply about what was learned:

**Errors & Fixes:**
- What went wrong? Root cause?
- How was it fixed?
- How to avoid in future?

**Patterns & Approaches:**
- What worked well?
- What approach failed?
- Better alternatives discovered?

**Gotchas & Quirks:**
- Non-obvious behavior found
- Undocumented issues
- Platform/library surprises

**Decisions & Context:**
- Why was X chosen over Y?
- Trade-offs considered
- Context that led to decision

### Filter Criteria

Only capture insights that are:
1. **Reusable** — will help in future similar situations
2. **Non-obvious** — not common knowledge or basic docs
3. **Project-relevant** — applies to this codebase/stack

**Skip:**
- Standard syntax or basic patterns
- Things already documented in rules/
- Obvious best practices

**If nothing valuable found → say so and exit gracefully:**
> "Reviewed the conversation but found no learnings worth preserving. The work was straightforward without non-obvious insights."

---

## Phase 2: Check Existing Learnings

Before creating new learnings, check for duplicates:

```bash
# Glob existing learnings
docs/learnings/*.md
```

Read titles and tags from existing files to avoid duplicates.
If a similar learning exists, consider:
- Skip (already covered)
- Update existing (new details)
- Create new (different angle)

**Also check `.claude/rules/`** — if learning is general enough, it might belong there instead.

---

## Phase 3: Draft the Learning

Each learning becomes a separate file.

### File naming

```
docs/learnings/YYYY-MM-DD-kebab-case-title.md
```

Examples:
- `2026-02-04-zod-error-transformation.md`
- `2026-02-04-timescale-hypertable-chunk-size.md`

### File template

```markdown
---
date: YYYY-MM-DD
tags: [tag1, tag2, tag3]
---

# Title (clear, descriptive)

**Context:** What we were doing - 1 sentence

## Learning

The actual insight - concise, actionable.
Use bullet points for multiple related points.

## Example

```language
Specific code or command demonstrating the learning
```

## References

- Link to docs if applicable
- Related files in codebase
```

### Tag guidelines

Use lowercase, consistent tags:
- Tech: `typescript`, `fastify`, `nextjs`, `postgres`, `timescaledb`
- Domain: `api`, `auth`, `database`, `frontend`, `testing`
- Type: `gotcha`, `pattern`, `fix`, `decision`

---

## Phase 4: User Approval ⚠️ BLOCKING

Present proposed learnings clearly:

```
## Learnings Found

### 1. Zod error transformation
**File:** `docs/learnings/2026-02-04-zod-error-transformation.md`
**Tags:** `api`, `validation`, `zod`

**Content preview:**
> Zod's default error format is nested and hard to use on frontend.
> Transform with `error.flatten()` before sending to client.

---

### 2. [Another learning if applicable]
...

---

Approve? (yes / no / edit)
```

**WAIT for explicit user approval before saving.**

User can:
- **yes** — save all
- **no** — discard
- **edit** — request changes (tags, title, content)
- **1, 2** — approve only specific learnings by number

---

## Phase 5: Save & Update Index

After approval:

### 1. Create directory if needed

```
docs/learnings/
```

### 2. Write each learning file

Save to `docs/learnings/YYYY-MM-DD-kebab-title.md`

### 3. Regenerate index

Read all `docs/learnings/*.md` files and regenerate `docs/learnings/README.md`:

```markdown
# Learnings Index

Project insights from implementation sessions.

| Date | Title | Tags |
|------|-------|------|
| 2026-02-04 | [Zod error transformation](./2026-02-04-zod-error-transformation.md) | `api`, `validation` |
| 2026-02-04 | [TimescaleDB chunk sizing](./2026-02-04-timescale-chunk-sizing.md) | `database`, `timescaledb` |

---

## By Tag

### api
- [Zod error transformation](./2026-02-04-zod-error-transformation.md)

### database
- [TimescaleDB chunk sizing](./2026-02-04-timescale-chunk-sizing.md)

---

*Auto-generated by /learn skill*
```

### 4. Confirm

```
Saved 2 learnings:
- docs/learnings/2026-02-04-zod-error-transformation.md
- docs/learnings/2026-02-04-timescale-chunk-sizing.md

Index updated: docs/learnings/README.md
```

---

## Learnings vs Rules

| Learnings | Rules |
|-----------|-------|
| `docs/learnings/*.md` | `.claude/rules/*.md` |
| Project-specific experiences | General standards |
| Individual files with dates | Permanent reference |
| Discoveries & fixes | Conventions & patterns |

**Promotion flow:**
If a learning proves valuable across multiple sessions → suggest promoting to `.claude/rules/[topic].md`

---

## Example

```
User: /learn API error handling

Claude: ## Phase 1: Analysis

Reviewing conversation for API error handling insights...

## Phase 2: Checking existing

Found 3 existing learnings in docs/learnings/
None overlap with current findings.

## Phase 4: Approval Required

### 1. Zod error transformation
**File:** `docs/learnings/2026-02-04-zod-error-transformation.md`
**Tags:** `api`, `validation`, `zod`, `gotcha`

**Content preview:**
> Zod's default error format is nested. Use `error.flatten()`
> for frontend-friendly format.

---

Approve? (yes / no / edit)

User: yes

Claude: Saved 1 learning:
- docs/learnings/2026-02-04-zod-error-transformation.md

Index updated: docs/learnings/README.md
```

---

## Notes

- One file per learning = zero merge conflicts in parallel work
- Tags enable filtering and discovery
- Index auto-regenerates on each save
- Review periodically — archive or promote stale learnings
- If unsure whether to save → ask user
